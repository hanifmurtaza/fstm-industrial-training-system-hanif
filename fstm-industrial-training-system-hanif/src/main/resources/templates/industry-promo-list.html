<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Industry – Opportunities</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap + Icons + Font -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Global theme -->
    <link th:href="@{/app.css}" rel="stylesheet" />

    <style>
        /* page-specific only */
        img.thumb{ width:52px; height:36px; object-fit:cover; border-radius:8px; border:1px solid rgba(148,163,184,.25); }
        .status-badge{ font-size:.75rem; font-weight:700; border-radius:999px; padding:.35rem .7rem; }
        .col-actions{ white-space:nowrap; }
        .link-title{ text-decoration:none; }
        .link-title:hover{ text-decoration:underline; }
    </style>
</head>

<body>

<!-- Navbar (same as Industry dashboard) -->
<nav class="navbar navbar-expand-lg appbar">
    <div class="container container-narrow">
        <a class="navbar-brand d-flex align-items-center gap-2" th:href="@{/industry/dashboard}">
            <img th:src="@{/Picture1.png}" alt="UPM" style="height:28px">
            <span>Industry Supervisor • UPM Industrial Training</span>
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navIndustry">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div id="navIndustry" class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" th:href="@{/industry/dashboard}">Dashboard</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/industry/logbooks}">Logbooks</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/industry/placements}">Placements</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/industry/evaluations}">Evaluations</a></li>
                <li class="nav-item"><a class="nav-link fw-semibold" th:href="@{/industry/opportunities}">Opportunities</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/industry/companies}">Profile</a></li>
                <li class="nav-item">
                    <form th:action="@{/logout}" method="post" class="d-flex align-items-center h-100 m-0 p-0">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        <button type="submit" class="nav-link btn btn-link p-0 m-0 border-0 bg-transparent">
                            Logout
                        </button>
                    </form>
                </li>
            </ul>
        </div>
    </div>
</nav>

<main class="container container-narrow py-4">

    <!-- Header -->
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
        <div>
            <span class="pill"><i class="bi bi-megaphone"></i> Opportunities</span>
            <h1 class="h4 page-title mb-0 mt-2">My Opportunity Posts</h1>
            <div class="muted mt-1">Create, publish, or archive internship posts visible to students.</div>
        </div>

        <a th:href="@{/industry/opportunities/new}" class="btn btn-primary btn-rounded">
            <i class="bi bi-plus-lg me-1"></i> New Post
        </a>
    </div>

    <!-- Filter card -->
    <div class="card-soft p-3 p-md-4 mb-3">
        <form class="row g-2 align-items-end" method="get" th:action="@{/industry/opportunities}">
            <div class="col-md-4">
                <label class="form-label mb-1 fw-semibold" for="statusSelect">Status</label>
                <select id="statusSelect" class="form-select form-select-sm" name="status">
                    <option value="" th:selected="${status == null}">All statuses</option>
                    <option value="DRAFT" th:selected="${status?.name() == 'DRAFT'}">Draft</option>
                    <option value="PUBLISHED" th:selected="${status?.name() == 'PUBLISHED'}">Published</option>
                    <option value="ARCHIVED" th:selected="${status?.name() == 'ARCHIVED'}">Archived</option>
                </select>
            </div>

            <div class="col-md-2 d-grid">
                <button class="btn btn-outline-primary btn-rounded" type="submit">
                    <i class="bi bi-funnel me-1"></i> Apply
                </button>
            </div>

            <div class="col-md-6">
                <div class="small-note">
                    Tip: keep posts as <span class="fw-semibold">Draft</span> while editing, then publish when ready.
                </div>
            </div>
        </form>
    </div>

    <!-- Table card -->
    <div class="card-soft p-3 p-md-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0 align-middle">
                <thead class="table-light">
                <tr>
                    <th style="width:70px;">ID</th>
                    <th style="width:76px;">Img</th>
                    <th style="min-width:260px;">Title</th>
                    <th style="min-width:200px;">Company</th>
                    <th style="min-width:160px;">Location</th>
                    <th style="min-width:140px;">Status</th>
                    <th class="text-end col-actions" style="min-width:260px;">Actions</th>
                </tr>
                </thead>

                <tbody>
                <tr th:if="${items == null || items.content == null || items.content.size() == 0}">
                    <td colspan="7" class="text-center muted py-4">No posts found.</td>
                </tr>

                <tr th:each="p : ${items.content}">
                    <td th:text="${p.id}">1</td>

                    <td>
                        <img class="thumb" th:if="${p.imageUrl}" th:src="${p.imageUrl}" alt="">
                        <div th:if="${p.imageUrl == null}" class="muted small">—</div>
                    </td>

                    <td>
                        <a class="fw-semibold link-title"
                           th:href="@{'/industry/opportunities/' + ${p.id}}"
                           th:text="${p.title}">
                            Title
                        </a>
                        <div class="small-note"
                             th:text="${p.roleType} + ' · ' + ${p.workMode}">
                            Internship · Onsite
                        </div>
                    </td>

                    <td th:text="${p.companyName}">Company</td>
                    <td th:text="${p.location}">Location</td>

                    <td>
                        <span class="badge status-badge text-bg-secondary" th:if="${p.status.name()=='DRAFT'}">DRAFT</span>
                        <span class="badge status-badge text-bg-success" th:if="${p.status.name()=='PUBLISHED'}">PUBLISHED</span>
                        <span class="badge status-badge text-bg-dark" th:if="${p.status.name()=='ARCHIVED'}">ARCHIVED</span>
                    </td>

                    <td class="text-end col-actions">
                        <a class="btn btn-sm btn-outline-primary btn-rounded"
                           th:href="@{'/industry/opportunities/' + ${p.id}}">
                            Edit
                        </a>

                        <form th:action="@{'/industry/opportunities/' + ${p.id} + '/publish'}"
                              method="post"
                              class="d-inline"
                              th:if="${p.status.name() != 'PUBLISHED'}">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                            <button class="btn btn-sm btn-success btn-rounded" type="submit">
                                Publish
                            </button>
                        </form>

                        <form th:action="@{'/industry/opportunities/' + ${p.id} + '/archive'}"
                              method="post"
                              class="d-inline"
                              th:if="${p.status.name() != 'ARCHIVED'}">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                            <button class="btn btn-sm btn-outline-secondary btn-rounded" type="submit">
                                Archive
                            </button>
                        </form>
                    </td>
                </tr>
                </tbody>

            </table>
        </div>
    </div>

    <!-- Footer row (pagination) -->
    <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mt-3">
        <div class="small-note"
             th:text="${items != null ? 'Total: ' + items.totalElements + ' items' : 'Total: 0 items'}">
            Total: 0 items
        </div>

        <div>
            <a class="btn btn-sm btn-outline-primary btn-rounded me-1"
               th:href="@{|/industry/opportunities?page=${items.number - 1}&size=${items.size}${status!=null?'&status='+status.name():''}|}"
               th:classappend="${items == null || items.first} ? ' disabled'">
                Prev
            </a>

            <a class="btn btn-sm btn-outline-primary btn-rounded"
               th:href="@{|/industry/opportunities?page=${items.number + 1}&size=${items.size}${status!=null?'&status='+status.name():''}|}"
               th:classappend="${items == null || items.last} ? ' disabled'">
                Next
            </a>
        </div>
    </div>

</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
