<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title>Industry Supervisor Evaluation (40%)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap + Icons + Font (match dashboard) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Global theme -->
  <link th:href="@{/app.css}" rel="stylesheet">

  <style>
    /* page-specific only */
    .badge-pill{
      border-radius:999px;
      padding:.35rem .8rem;
      font-size:.75rem;
      font-weight:700;
    }
    .col-action{ white-space:nowrap; }
  </style>
</head>

<body>

<!-- Navbar (same as Industry dashboard) -->
<nav class="navbar navbar-expand-lg appbar">
  <div class="container container-narrow">
    <a class="navbar-brand d-flex align-items-center gap-2" th:href="@{/industry/dashboard}">
      <img th:src="@{/Picture1.png}" alt="UPM" style="height:28px">
      <span>Industry Supervisor Panel</span>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navIndustry">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navIndustry">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a th:href="@{/industry/dashboard}" class="nav-link">Dashboard</a></li>
        <li class="nav-item"><a th:href="@{/industry/companies}" class="nav-link">Profile</a></li>
        <li class="nav-item"><a th:href="@{/industry/placements}" class="nav-link">Placements</a></li>
        <li class="nav-item"><a th:href="@{/industry/logbooks}" class="nav-link">Logbooks</a></li>
        <li class="nav-item"><a th:href="@{/industry/evaluations}" class="nav-link">Evaluations</a></li>
        <li class="nav-item"><a th:href="@{/industry/opportunities}" class="nav-link">Opportunities</a></li>
        <li class="nav-item">
          <form th:action="@{/logout}" method="post" class="d-flex align-items-center h-100 m-0 p-0">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <button type="submit" class="nav-link btn btn-link p-0 m-0 border-0 bg-transparent">
              Logout
            </button>
          </form>
        </li>
      </ul>
    </div>
  </div>
</nav>

<main class="container container-narrow py-4">

  <!-- Header -->
  <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
    <div>
      <span class="pill"><i class="bi bi-clipboard2-check"></i> Evaluations</span>
      <h1 class="h4 page-title mb-0 mt-2">Industry Supervisor Evaluation (40%)</h1>
      <div class="muted mt-1">
        Complete the end-of-Industrial Training evaluation for each approved placement assigned to you.
      </div>
    </div>
  </div>

  <!-- Table card -->
  <div class="card-soft p-3 p-md-0">
    <div class="table-responsive">
      <table class="table mb-0 align-middle">
        <thead class="table-light">
        <tr>
          <th style="min-width:260px;">Student</th>
          <th style="min-width:240px;">Company</th>
          <th style="min-width:200px;">Period</th>
          <th style="min-width:130px;">Status</th>
          <th class="text-end col-action" style="min-width:140px;">Action</th>
        </tr>
        </thead>

        <tbody>
        <!-- Empty state -->
        <tr th:if="${placements == null or #lists.isEmpty(placements)}">
          <td colspan="5" class="text-center muted py-4">
            No placements are currently available for evaluation.
          </td>
        </tr>

        <!-- Rows -->
        <tr th:each="p : ${placements}">
          <!-- Student -->
          <td>
            <div class="fw-semibold"
                 th:text="${userById[p.studentId] != null && userById[p.studentId].name != null
                           ? userById[p.studentId].name
                           : 'Student ID ' + p.studentId}">
              Student Name
            </div>
            <div class="small-note"
                 th:text="${userById[p.studentId] != null && userById[p.studentId].studentId != null
                           ? 'Matric: ' + userById[p.studentId].studentId
                           : 'Student ID: ' + p.studentId}">
              Matric: -
            </div>
          </td>

          <!-- Company -->
          <td>
            <div class="fw-semibold"
                 th:text="${companyById[p.companyId] != null && companyById[p.companyId].name != null
                           ? companyById[p.companyId].name
                           : 'Company ID ' + p.companyId}">
              Company Name
            </div>
          </td>

          <!-- Period -->
          <td class="muted">
            <span th:text="${p.startDate != null ? #temporals.format(p.startDate, 'dd/MM/yyyy') : '-'}">-</span>
            <span> â€“ </span>
            <span th:text="${p.endDate != null ? #temporals.format(p.endDate, 'dd/MM/yyyy') : '-'}">-</span>
          </td>

          <!-- Status -->
          <td>
            <span th:if="${evalByPlacementId != null and evalByPlacementId[p.id] != null}"
                  class="badge badge-pill bg-success">
              Evaluated
            </span>

            <span th:if="${evalByPlacementId == null or evalByPlacementId[p.id] == null}"
                  class="badge badge-pill bg-warning text-dark">
              Pending
            </span>
          </td>

          <!-- Action -->
          <td class="text-end col-action">
            <a th:if="${evalByPlacementId == null or evalByPlacementId[p.id] == null}"
               class="btn btn-sm btn-primary btn-rounded"
               th:href="@{/industry/evaluations/{id}(id=${p.id})}">
              Open Form
            </a>

            <a th:if="${evalByPlacementId != null and evalByPlacementId[p.id] != null}"
               class="btn btn-sm btn-outline-primary btn-rounded"
               th:href="@{/industry/evaluations/{id}(id=${p.id})}">
              View
            </a>
          </td>
        </tr>
        </tbody>

      </table>
    </div>
  </div>

</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
