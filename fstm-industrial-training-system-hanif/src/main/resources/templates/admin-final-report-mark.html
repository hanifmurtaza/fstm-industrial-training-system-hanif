<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mark Final Report • UPM Industrial Training</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap + Icons + Font -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- your global css -->
  <link th:href="@{/app.css}" rel="stylesheet">

  <style>
    :root{
      --border: rgba(148,163,184,.25);
      --muted:#64748b;
      --ink:#0f172a;
      --bg:#f5f7fa;
    }
    body{ font-family:'Inter',system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; background:var(--bg); color:var(--ink); }
    .container-narrow{ max-width:980px; }

    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:6px 12px; border-radius:999px;
      background:#eef2ff; color:#1e40af;
      font-size:.85rem; font-weight:800;
    }
    .page-title{ letter-spacing:-0.2px; }
    .muted{ color:var(--muted); }

    .card-soft{
      background:#fff;
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow:0 12px 30px rgba(15,23,42,.10);
    }

    .btn-rounded{ border-radius:12px; padding:.6rem .95rem; }
    .btn-sm.btn-rounded{ padding:.45rem .7rem; border-radius:10px; }

    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

    .link-box{
      border:1px dashed rgba(148,163,184,.55);
      border-radius:14px;
      padding:12px;
      background:#fff;
    }
    .badge-pill{
      border-radius:999px;
      padding:.45rem .7rem;
      font-weight:900;
      font-size:.72rem;
      letter-spacing:.04em;
      border:1px solid transparent;
      white-space:nowrap;
      display:inline-block;
    }
    .badge-ok{ background:#E6F4EA; color:#1F7A39; border-color:rgba(31,122,57,.15); }
    .badge-na{ background:#EEF2F7; color:#475569; border-color:rgba(71,85,105,.18); }
  </style>
</head>

<body>

<!-- Navbar (match dashboard) -->
<nav class="navbar navbar-expand-lg appbar">
  <div class="container container-narrow">
    <a class="navbar-brand d-flex align-items-center gap-2" th:href="@{/admin/dashboard}">
      <img th:src="@{/Picture1.png}" alt="UPM" style="height:28px">
      <span>Admin Panel • UPM Industrial Training</span>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navAdminFR2">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navAdminFR2" class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a th:href="@{/admin/students}" class="nav-link">Students</a></li>
        <li class="nav-item"><a th:href="@{/admin/lecturers}" class="nav-link">Lecturers</a></li>
        <li class="nav-item"><a th:href="@{/admin/evaluations}" class="nav-link">Evaluations</a></li>
        <li class="nav-item"><a th:href="@{/admin/final-reports}" class="nav-link active">Final Report</a></li>
        <li class="nav-item"><a th:href="@{/admin/company-master}" class="nav-link">Company Master</a></li>
        <li class="nav-item"><a th:href="@{/admin/company-info(status='PENDING')}" class="nav-link">Submissions</a></li>
        <li class="nav-item"><a th:href="@{/admin/placements}" class="nav-link">Placements</a></li>
        <li class="nav-item"><a th:href="@{/logout}" class="nav-link">Logout</a></li>
      </ul>
    </div>
  </div>
</nav>

<main class="container container-narrow py-4">

  <!-- Header -->
  <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
    <div>
      <span class="pill"><i class="bi bi-pencil-square"></i> Mark</span>
      <h1 class="h4 page-title mb-0 mt-2">Final Report & Video Marking</h1>
      <div class="muted mt-1">Written Report (5) + Video (5). Open student submission below.</div>
    </div>

    <div class="d-flex gap-2">
      <a class="btn btn-outline-primary btn-rounded" th:href="@{/admin/final-reports}">
        <i class="bi bi-arrow-left me-1"></i> Back
      </a>
      <a class="btn btn-outline-primary btn-rounded" th:href="@{/admin/dashboard}">
        <i class="bi bi-house me-1"></i> Dashboard
      </a>
    </div>
  </div>

  <!-- Student info -->
  <div class="card-soft p-3 p-md-4 mb-3">
    <div class="d-flex flex-wrap justify-content-between align-items-start gap-2">
      <div>
        <div class="fw-semibold fs-5"
             th:text="${student.name != null && !#strings.isEmpty(student.name) ? student.name : student.username}">
          Student Name
        </div>
        <div class="muted small">
          <span class="mono" th:text="${student.username}">username</span>
          <span class="mx-2">•</span>
          <span class="mono" th:text="${student.studentId != null ? student.studentId : '-'}">-</span>
          <span class="mx-2">•</span>
          <span th:text="${student.session != null ? student.session : '-'}">Session</span>
        </div>
      </div>

      <div class="text-end">
        <span class="badge-pill badge-ok">Admin Marking (10%)</span>
      </div>
    </div>
  </div>

  <!-- Submission links -->
  <div class="row g-3 mb-3">
    <div class="col-12 col-md-6">
      <div class="card-soft p-3 p-md-4 h-100">
        <div class="d-flex align-items-center justify-content-between">
          <div class="fw-bold"><i class="bi bi-file-earmark-pdf me-1"></i> Final Report (PDF)</div>
          <span th:if="${student.finalReportPdfPath != null && !#strings.isEmpty(student.finalReportPdfPath)}"
                class="badge-pill badge-ok">SUBMITTED</span>
          <span th:if="${student.finalReportPdfPath == null || #strings.isEmpty(student.finalReportPdfPath)}"
                class="badge-pill badge-na">NO</span>
        </div>

        <div class="link-box mt-3">
          <div th:if="${student.finalReportPdfPath != null && !#strings.isEmpty(student.finalReportPdfPath)}">
            <a class="btn btn-sm btn-primary btn-rounded"
               th:href="${student.finalReportPdfPath}"
               target="_blank">
              <i class="bi bi-box-arrow-up-right me-1"></i> Open PDF
            </a>
            <div class="muted small mt-2 mono" th:text="${student.finalReportPdfPath}">/uploads/..</div>
          </div>

          <div th:if="${student.finalReportPdfPath == null || #strings.isEmpty(student.finalReportPdfPath)}"
               class="muted">
            No PDF submitted yet.
          </div>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-6">
      <div class="card-soft p-3 p-md-4 h-100">
        <div class="d-flex align-items-center justify-content-between">
          <div class="fw-bold"><i class="bi bi-camera-video me-1"></i> Video Link</div>
          <span th:if="${student.finalReportVideoPath != null && !#strings.isEmpty(student.finalReportVideoPath)}"
                class="badge-pill badge-ok">SUBMITTED</span>
          <span th:if="${student.finalReportVideoPath == null || #strings.isEmpty(student.finalReportVideoPath)}"
                class="badge-pill badge-na">NO</span>
        </div>

        <div class="link-box mt-3">
          <div th:if="${student.finalReportVideoPath != null && !#strings.isEmpty(student.finalReportVideoPath)}">
            <a class="btn btn-sm btn-primary btn-rounded"
               th:href="${student.finalReportVideoPath}"
               target="_blank" rel="noopener">
              <i class="bi bi-box-arrow-up-right me-1"></i> Open Video Link
            </a>
            <div class="muted small mt-2 mono" th:text="${student.finalReportVideoPath}">https://...</div>
          </div>

          <div th:if="${student.finalReportVideoPath == null || #strings.isEmpty(student.finalReportVideoPath)}"
               class="muted">
            No video link submitted yet.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mark form -->
  <form th:action="@{/admin/final-reports/mark}" method="post"
        class="card-soft p-3 p-md-4">

    <input type="hidden" name="studentId" th:value="${student.id}">
    <input type="hidden" name="sessionStr" th:value="${sessionStr}">

    <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
      <div>
        <div class="fw-bold">Enter marks</div>
        <div class="muted small">Written (0–5) + Video (0–5). You can use decimals like 0.5.</div>
      </div>
    </div>

    <div class="row g-3">
      <div class="col-12 col-md-6">
        <label class="form-label mb-1 fw-semibold">Written Report (0–5)</label>
        <input type="number" step="0.5" min="0" max="5"
               class="form-control"
               name="written5"
               th:value="${sa != null ? sa.adminReportWritten5 : ''}">
      </div>

      <div class="col-12 col-md-6">
        <label class="form-label mb-1 fw-semibold">Video (0–5)</label>
        <input type="number" step="0.5" min="0" max="5"
               class="form-control"
               name="video5"
               th:value="${sa != null ? sa.adminReportVideo5 : ''}">
      </div>

      <div class="col-12">
        <div class="muted small">
          Current total (10):
          <span class="fw-semibold"
                th:text="${(sa != null && sa.adminReportWritten5 != null ? sa.adminReportWritten5 : 0)
                     + (sa != null && sa.adminReportVideo5 != null ? sa.adminReportVideo5 : 0)}">0</span>
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-end gap-2 mt-4">
      <a class="btn btn-outline-secondary btn-rounded" th:href="@{/admin/final-reports}">
        Cancel
      </a>
      <button class="btn btn-primary btn-rounded" type="submit">
        <i class="bi bi-save me-1"></i> Save Marks
      </button>
    </div>
  </form>



</main>

<footer class="text-center text-muted py-4 small">
  © <span th:text="${#dates.format(#dates.createNow(), 'yyyy')}">2025</span>, Faculty of Food Science and Technology, UPM
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
