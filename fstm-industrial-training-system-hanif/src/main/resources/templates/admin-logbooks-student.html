<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Logbooks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    :root{ --border:#e5e7eb; --muted:#6b7280; }
    body{ background:#f5f7fa; }
    .container-narrow{ max-width:1240px; }
    .appbar{ background:#0d6efd; color:#fff; }
    .appbar a{ color:#fff; text-decoration:none; }
    .table-card{ border:1px solid var(--border); border-radius:14px; overflow:hidden; box-shadow:0 8px 18px rgba(0,0,0,.06); }
    .table thead th{ background:#fff; position:sticky; top:0; z-index:2; border-bottom:1px solid var(--border); }
    .table-responsive{ max-height:64vh; overflow:auto; }
    .pill{ font-weight:700; padding:.25rem .5rem; border-radius:999px; font-size:.85rem; display:inline-block; }
    .pill-ok{ background:#E6F4EA; color:#1F7A39; }
    .pill-warn{ background:#FFF4E5; color:#9A6700; }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg appbar">
  <div class="container container-narrow">
    <a class="navbar-brand d-flex align-items-center gap-2" th:href="@{/admin/logbooks/students}">
      <img th:src="@{/Picture1.png}" alt="UPM" style="height:26px">
      <span>Admin • Student Logbooks</span>
    </a>
    <div class="ms-auto d-flex gap-2">
      <a th:href="@{/admin/logbooks/students}" class="btn btn-outline-light btn-sm">Back</a>
      <a th:href="@{/admin/dashboard}" class="btn btn-outline-light btn-sm">Dashboard</a>
    </div>
  </div>
</nav>

<main class="container container-narrow py-4">

  <div class="mb-3">
    <h1 class="h4 mb-1" th:text="${student.name}">Student Name</h1>
    <div class="text-muted">
      Matric: <span th:text="${student.studentId}">-</span>
      • Session: <span th:text="${student.session}">-</span>
      • Lecturer:
      <span th:if="${student.lecturer != null}" th:text="${student.lecturer.name}">-</span>
      <span th:if="${student.lecturer == null}">Not assigned</span>
    </div>
  </div>

  <!-- Admin Logbook Mark (10%) -->
  <div class="table-card mb-3" style="border-radius:14px;">
    <div class="p-3 border-bottom d-flex flex-wrap align-items-center justify-content-between gap-2">
      <div>
        <div class="fw-semibold">Logbook Mark (10%)</div>
        <div class="text-muted small">
          Mark the student’s overall weekly logbook performance for this session.
        </div>
      </div>

      <div class="d-flex align-items-center gap-2">
        <span class="text-muted small">Current:</span>
        <span class="pill pill-ok" th:text="${sa != null ? sa.adminLogbook10 : 0}">0</span>
        <span class="text-muted small">/ 10</span>
      </div>
    </div>

    <div class="p-3">
      <form class="row g-2 align-items-end" method="post" th:action="@{/admin/logbooks/mark}">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
        <input type="hidden" name="studentId" th:value="${student.id}">
        <input type="hidden" name="sessionStr" th:value="${sessionStr}">

        <div class="col-12 col-md-4">
          <label class="form-label mb-1">Mark (0–10)</label>
          <input type="number" step="0.5" min="0" max="10"
                 class="form-control"
                 name="logbook10"
                 th:value="${sa != null ? sa.adminLogbook10 : 0}">
        </div>

        <div class="col-12 col-md-3">
          <button class="btn btn-primary w-100" type="submit">
            Save Mark
          </button>
        </div>

        <div class="col-12 col-md-5 text-muted small">
          Tip: You can use 0.5 steps (e.g., 7.5).
        </div>
      </form>
    </div>
  </div>


  <!-- filter -->
  <form class="row g-2 align-items-end mb-3" method="get"
        th:action="@{'/admin/logbooks/student/' + ${student.id}}">
    <div class="col-12 col-md-3">
      <label class="form-label mb-1">Status</label>
      <select class="form-select" name="status">
        <option value="" th:selected="${status == null}">All</option>
        <option value="PENDING" th:selected="${status?.name() == 'PENDING'}">PENDING</option>
        <option value="APPROVED" th:selected="${status?.name() == 'APPROVED'}">APPROVED</option>
        <option value="REJECTED" th:selected="${status?.name() == 'REJECTED'}">REJECTED</option>
      </select>
    </div>
    <input type="hidden" name="size" th:value="${size}"/>
    <div class="col-6 col-md-2">
      <button class="btn btn-primary w-100" type="submit">Filter</button>
    </div>
  </form>

  <div class="table-card">
    <div class="table-responsive">
      <table class="table table-striped align-middle mb-0">
        <thead>
        <tr>
          <th style="width:160px;">Week Start</th>
          <th style="width:200px;">Created</th>
          <th style="width:120px;">Status</th>
          <th style="width:120px;">Sup</th>
          <th style="width:120px;">Action</th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${#lists.isEmpty(logbooks.content)}">
          <td colspan="5" class="text-center text-muted py-4">No logbooks found.</td>
        </tr>

        <tr th:each="e : ${logbooks.content}">
          <td th:text="${e.weekStartDate != null ? #temporals.format(e.weekStartDate, 'dd MMM yyyy') : '-'}">-</td>
          <td th:text="${e.createdAt != null ? #dates.format(e.createdAt, 'dd MMM yyyy, HH:mm') : '-'}">-</td>

          <td>
            <span class="pill pill-warn" th:if="${e.status.name() == 'PENDING'}">PENDING</span>
            <span class="pill pill-ok" th:if="${e.status.name() == 'APPROVED'}">APPROVED</span>
            <span class="pill" style="background:#FDECEC;color:#B42318;"
                  th:if="${e.status.name() == 'REJECTED'}">REJECTED</span>
          </td>

          <td>
            <span class="pill pill-ok" th:if="${e.endorsed}">YES</span>
            <span class="pill" style="background:#ECEEF3;color:#495057;" th:if="${!e.endorsed}">NO</span>
          </td>

          <td>
            <a class="btn btn-sm btn-outline-primary"
               th:href="@{'/admin/logbooks/' + ${e.id}}">
              View
            </a>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <div class="p-3 d-flex justify-content-between align-items-center border-top">
      <div class="text-muted">
        Page <span th:text="${currentPage + 1}">1</span> / <span th:text="${totalPages}">1</span>
      </div>
      <div class="btn-group">
        <a class="btn btn-outline-secondary btn-sm"
           th:if="${currentPage > 0}"
           th:href="@{'/admin/logbooks/student/' + ${student.id} + '(status=' + ${status} + ',page=' + ${currentPage-1} + ',size=' + ${size} + ')'}">
          Prev
        </a>
        <a class="btn btn-outline-secondary btn-sm"
           th:if="${currentPage + 1 < totalPages}"
           th:href="@{'/admin/logbooks/student/' + ${student.id} + '(status=' + ${status} + ',page=' + ${currentPage+1} + ',size=' + ${size} + ')'}">
          Next
        </a>
      </div>
    </div>
  </div>

</main>
</body>
</html>
