<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
  <title>Final Report Submissions</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>

<body>
<section layout:fragment="content">

  <div class="card p-4 shadow-sm mb-4">
    <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
      <h5 class="m-0">
        <i class="bi bi-file-earmark-text me-1"></i>
        Final Report Submissions
      </h5>
      <div class="text-muted small">
        Total: <span th:text="${#lists.size(students)}">0</span>
      </div>
    </div>

    <!-- Filter -->
    <form class="row g-2 align-items-end mb-3" method="get" th:action="@{/lecturer/final-report/list}">
      <div class="col-auto">
        <label for="sessionSelect" class="form-label mb-0 fw-semibold">Session</label>
        <select id="sessionSelect" name="session" class="form-select form-select-sm" style="min-width: 200px;">
          <option value="" th:selected="${selectedSession == null or selectedSession == ''}">All sessions</option>
          <th:block th:each="s : ${sessions}">
            <option th:value="${s}"
                    th:text="${s}"
                    th:selected="${selectedSession != null and selectedSession.equals(s)}"></option>
          </th:block>
        </select>
      </div>

      <div class="col-auto">
        <button type="submit" class="btn btn-primary btn-sm">
          <i class="bi bi-funnel"></i> Filter
        </button>
        <a class="btn btn-outline-secondary btn-sm" th:href="@{/lecturer/final-report/list}">Reset</a>
      </div>
    </form>

    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle text-center">
        <thead class="table-primary">
        <tr>
          <th style="width:70px;">No</th>
          <th>Name</th>
          <th style="width:160px;">Student ID</th>
          <th style="width:160px;">Session</th>
          <th style="width:240px;">Report (PDF)</th>
          <th style="width:240px;">Video </th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="stu, iter : ${students}">
          <td th:text="${iter.index + 1}">1</td>
          <td th:text="${stu.name}">Student Name</td>
          <td th:text="${stu.studentId}">000000</td>
          <td th:text="${stu.session}">2024/2025-2</td>

          <!-- PDF -->
          <td>
            <span th:if="${stu.finalReportPdfPath == null}" class="text-muted">Not uploaded</span>

            <span th:if="${stu.finalReportPdfPath != null}" class="d-inline-flex gap-2">
              <a th:href="${stu.finalReportPdfPath}" target="_blank" class="btn btn-sm btn-outline-primary">
                <i class="bi bi-eye"></i> View
              </a>
              <a th:href="@{'/lecturer/final-report/download/pdf/' + ${stu.id}}"
                 class="btn btn-sm btn-outline-secondary">
                <i class="bi bi-download"></i> Download
              </a>
            </span>
          </td>

          <!-- Video Link -->
          <td>
            <span th:if="${stu.finalReportVideoPath == null}" class="text-muted">Not submitted</span>

            <span th:if="${stu.finalReportVideoPath != null}" class="d-inline-flex gap-2">
    <a th:href="${stu.finalReportVideoPath}" target="_blank"
       class="btn btn-sm btn-outline-primary">
      <i class="bi bi-play-circle"></i> Open Video Link
    </a>

    <button type="button" class="btn btn-sm btn-outline-secondary"
            th:attr="data-link=${stu.finalReportVideoPath}"
            onclick="navigator.clipboard.writeText(this.dataset.link)">
      <i class="bi bi-clipboard"></i> Copy Link
    </button>
  </span>
          </td>

        </tr>

        <tr th:if="${#lists.isEmpty(students)}">
          <td colspan="6" class="text-muted py-4">No students found.</td>
        </tr>
        </tbody>
      </table>
    </div>

    <div class="mt-2 text-muted small">
      Record 1 to <span th:text="${#lists.size(students)}">0</span>
      daripada <span th:text="${#lists.size(students)}">0</span> record(s)
    </div>
  </div>

</section>
</body>
</html>