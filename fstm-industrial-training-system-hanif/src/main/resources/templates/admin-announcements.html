<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin • Announcements</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
  <style>
    body { background:#f5f7fa }
    .navbar { background:#0d6efd }
    .navbar-brand, .nav-link { color:#fff !important }
    .card { border-radius:12px; box-shadow:0 4px 8px rgba(0,0,0,.06) }
    .badge-soft{ background:#eef2ff; color:#1e40af; border:1px solid rgba(59,130,246,.25) }
  </style>
  <style>
    .appbar .nav-link,
    .appbar .nav-link button,
    .appbar button.nav-link {
      font-weight: 600 !important;
    }


  </style>
  <style>
    /* Ensure row background covers ALL columns, including Actions */
    .table tbody tr {
      background-color: transparent;
    }

    .table tbody tr:hover > * {
      background-color: rgba(15, 23, 42, 0.06) !important; /* same subtle hover/selected grey */
    }

    /* If you have a selected row class (optional) */
    .table tbody tr.is-selected > * {
      background-color: rgba(15, 23, 42, 0.08) !important;
    }

    /* Actions cell wrappers should not “paint” over the row bg */
    .table td .actions,
    .table td .btn-group,
    .table td.actions-col{
      text-align:right;
      white-space:nowrap;
    }


  </style>

</head>
<body>

<nav class="navbar navbar-expand-lg appbar">
  <div class="container container-narrow">
    <a class="navbar-brand d-flex align-items-center gap-2" th:href="@{/admin/dashboard}">
      <img th:src="@{/Picture1.png}" alt="UPM" style="height:28px">
      <span>Admin Panel • UPM Industrial Training</span>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navAdmin">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navAdmin" class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a th:href="@{/admin/students}" class="nav-link">Students</a></li>
        <li class="nav-item"><a th:href="@{/admin/lecturers}" class="nav-link">Lecturers</a></li>
        <li class="nav-item"><a th:href="@{/admin/evaluations}" class="nav-link">Evaluations</a></li>
        <li class="nav-item"><a th:href="@{/admin/company-master}" class="nav-link">Company Master</a></li>
        <li class="nav-item"><a th:href="@{/admin/company-info(status='PENDING')}" class="nav-link">Submissions</a></li>
        <li class="nav-item"><a th:href="@{/admin/placements}" class="nav-link">Placements</a></li>
        <li class="nav-item"><a th:href="@{/admin/announcements}" class="nav-link">Announcements</a></li>
        <li class="nav-item">
          <form th:action="@{/logout}" method="post" class="d-flex align-items-center h-100 m-0 p-0">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <button type="submit" class="nav-link btn btn-link p-0 m-0 border-0 bg-transparent">
              Logout
            </button>
          </form>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container py-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h3 class="m-0">Announcements</h3>
    <span class="text-muted" th:text="${#lists.size(announcements)} + ' items'">0 items</span>
  </div>

  <div th:if="${param.success}" class="alert alert-success py-2">Announcement uploaded successfully.</div>
  <div th:if="${error}" class="alert alert-danger py-2" th:text="${error}">Error</div>

  <!-- Upload form -->
  <div class="card p-3 mb-3">
    <h6 class="fw-bold mb-3"><i class="bi bi-megaphone"></i> Create new announcement</h6>
    <form th:action="@{/admin/announcements/upload}" method="post" enctype="multipart/form-data" class="row g-3">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">

      <div class="col-md-6">
        <label class="form-label">Announcement title</label>
        <input type="text" name="title" class="form-control" placeholder="e.g. IMPORTANT: Briefing for Industrial Training" required>
      </div>

      <div class="col-md-3">
        <label class="form-label">Target</label>
        <select name="audience" class="form-select">
          <option value="LECTURER">Visiting Lecturer only (home.html)</option>
          <option value="ALL">Public (login.html)</option>
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label">File</label>
        <input type="file" name="file" class="form-control" required>
      </div>

      <div class="col-12">
        <button class="btn btn-primary"><i class="bi bi-upload"></i> Upload</button>
        <span class="text-muted small ms-2">Users click the blue link to download the file.</span>
      </div>
    </form>
  </div>

  <!-- List -->
  <div class="card p-3">
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
        <tr>
          <th style="width:70px;">#</th>
          <th>Title</th>
          <th style="width:180px;">Target</th>
          <th style="width:220px;">Uploaded</th>
          <th style="width:200px;">Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="a, idx : ${announcements}">
          <td th:text="${idx.index + 1}">1</td>
          <td>
            <div class="fw-semibold" th:text="${a.title}">Title</div>
            <div class="small text-muted" th:text="${a.originalName}">file.pdf</div>
          </td>
          <td>
            <span class="badge badge-soft" th:text="${a.audience}">ALL</span>
          </td>
          <td th:text="${#temporals.format(a.uploadedAt, 'yyyy-MM-dd HH:mm')}">2025-01-01 10:00</td>
          <td class="actions-col">
            <div class="d-flex justify-content-end gap-2">
              <a class="btn btn-outline-primary btn-sm" th:href="@{'/announcement/download/' + ${a.id}}">
                <i class="bi bi-download"></i> Download
              </a>
              <form th:action="@{'/admin/announcements/delete/' + ${a.id}}" method="post"
                    onsubmit="return confirm('Delete this announcement?');" class="m-0">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                <button class="btn btn-outline-danger btn-sm" type="submit">
                  <i class="bi bi-trash"></i> Delete
                </button>
              </form>
            </div>
          </td>
        </tr>

        <tr th:if="${#lists.isEmpty(announcements)}">
          <td colspan="5" class="text-center text-muted py-4">
            <i class="bi bi-inbox"></i> No announcements yet.
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

</body>
</html>
