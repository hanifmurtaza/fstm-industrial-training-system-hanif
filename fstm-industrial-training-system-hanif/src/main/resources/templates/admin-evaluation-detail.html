<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin • Evaluation Detail</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        :root{
            --bg:#f5f7fa;
            --ink:#0f172a;
            --muted:#64748b;
            --border:rgba(148,163,184,.25);
        }
        body{ background:var(--bg); color:var(--ink); }
        .container-narrow{ max-width:1100px; }
        .card-soft{
            border-radius:16px;
            box-shadow:0 10px 26px rgba(15,23,42,.08);
            border:1px solid var(--border);
            background:#fff;
        }
        .section-title{ font-weight:800; letter-spacing:-.01em; }
        .muted{ color:var(--muted); }
        .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

        .pill{ display:inline-flex; align-items:center; gap:.4rem; padding:.35rem .7rem; border-radius:999px; font-weight:700; font-size:.75rem; }
        .pill-ok{ background:#E6F4EA; color:#1F7A39; border:1px solid rgba(31,122,57,.15); }
        .pill-na{ background:#EEF2F7; color:#475569; border:1px solid rgba(71,85,105,.18); }

        .score-card{ border:1px solid var(--border); border-radius:14px; background:#fff; }
        .score-head{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:.75rem; }
        .score-title{ font-weight:700; }
        .score-lines{ display:grid; gap:.35rem; }
        .score-line{ display:flex; align-items:center; justify-content:space-between; gap:10px; font-size:.92rem; }
        .score-line .label{ color:var(--muted); }
        .score-line .val{ font-weight:700; }
        .divider{ border-top:1px solid rgba(148,163,184,.35); margin:.8rem 0; }
        .comment-box{
            border:1px solid rgba(148,163,184,.28);
            background:#f8fafc;
            border-radius:12px;
            padding:.65rem .75rem;
            font-size:.92rem;
            color:#0f172a;
            white-space:pre-wrap;
        }
        .summary-grid{
            display:grid;
            grid-template-columns: repeat(3, minmax(0,1fr));
            gap:12px;
        }
        @media (max-width: 768px){
            .summary-grid{ grid-template-columns: 1fr; }
        }
    </style>
</head>

<body>

<div class="container container-narrow mt-5 mb-5">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-start gap-3 mb-3">
        <div>
            <h3 class="mb-1 section-title" th:text="${student.name != null ? student.name : student.username}">Student</h3>
            <div class="muted">
                <span th:text="${'Matric: ' + (student.studentId != null ? student.studentId : '-') }">Matric</span>
                <span class="mx-2">•</span>
                <span th:text="${'Session: ' + (student.session != null ? student.session : '-') }">Session</span>
            </div>
        </div>
        <a class="btn btn-primary" th:href="@{/admin/evaluations}">⬅ Back</a>
    </div>

    <!-- Context -->
    <div class="card-soft mb-4">
        <div class="p-3 p-md-4">
            <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
                <h5 class="mb-0 section-title">Evaluation Context</h5>
                <div class="muted small">Scores: 40 + 40 + 10 + 10</div>
            </div>

            <div class="row g-3">
                <div class="col-md-4">
                    <div class="fw-semibold">Industry Supervisor</div>
                    <div class="muted" th:text="${industrySupervisor != null ? industrySupervisor.name : '-'}">-</div>
                </div>
                <div class="col-md-4">
                    <div class="fw-semibold">Company</div>
                    <div class="muted" th:text="${company != null ? company.name : '-'}">-</div>
                </div>
                <div class="col-md-4">
                    <div class="fw-semibold">Visiting Lecturer</div>
                    <div class="muted" th:text="${visitingLecturer != null ? visitingLecturer.name : '-'}">-</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scores -->
    <div class="card-soft">
        <div class="p-3 p-md-4">

            <h5 class="mb-3 section-title">Scores</h5>

            <div class="row g-3">

                <!-- Visiting Lecturer (40) -->
                <div class="col-md-6">
                    <div class="score-card p-3 h-100">
                        <div class="score-head">
                            <div class="score-title">Visiting Lecturer (40)</div>
                            <span class="pill pill-na" th:if="${visitEval == null}">PENDING</span>
                            <span class="pill pill-ok" th:if="${visitEval != null}" th:text="${#numbers.formatDecimal(vl40,1,2) + ' / 40'}">0.00 / 40</span>
                        </div>

                        <div class="score-lines">
                            <div class="score-line">
                                <div class="label">Reflection</div>
                                <div class="val" th:text="${visitEval != null ? (visitEval.reflectionLikert != null ? (visitEval.reflectionLikert*2) : 0) : 0} + ' / 10'">0 / 10</div>
                            </div>
                            <div class="score-line">
                                <div class="label">Engagement</div>
                                <div class="val" th:text="${visitEval != null ? (visitEval.engagementLikert != null ? (visitEval.engagementLikert*2) : 0) : 0} + ' / 10'">0 / 10</div>
                            </div>
                            <div class="score-line">
                                <div class="label">Placement Suitability</div>
                                <div class="val" th:text="${visitEval != null ? (visitEval.placementSuitabilityLikert != null ? visitEval.placementSuitabilityLikert : 0) : 0} + ' / 5'">0 / 5</div>
                            </div>
                            <div class="score-line">
                                <div class="label">Logbook Review</div>
                                <div class="val" th:text="${visitEval != null ? (visitEval.logbookLikert != null ? visitEval.logbookLikert : 0) : 0} + ' / 5'">0 / 5</div>
                            </div>
                            <div class="score-line">
                                <div class="label">Overall</div>
                                <div class="val" th:text="${visitEval != null ? (visitEval.lecturerOverallLikert != null ? (visitEval.lecturerOverallLikert*2) : 0) : 0} + ' / 10'">0 / 10</div>
                            </div>
                        </div>

                        <div class="divider"></div>

                        <div class="score-line">
                            <div class="label fw-semibold">Total</div>
                            <div class="val" th:text="${#numbers.formatDecimal(vl40,1,2) + ' / 40'}">0.00 / 40</div>
                        </div>

                        <div class="divider"></div>

                        <div class="fw-semibold mb-2">Lecturer Comments</div>

                        <div class="small mb-2">
                            <div class="muted mb-1">Discussion Summary</div>
                            <div class="comment-box"
                                 th:text="${visitEval != null && visitEval.discussionSummary != null && !#strings.isEmpty(visitEval.discussionSummary) ? visitEval.discussionSummary : '—'}">—</div>
                        </div>

                        <div class="small mb-2">
                            <div class="muted mb-1">Overall Observation</div>
                            <div class="comment-box"
                                 th:text="${visitEval != null && visitEval.overallObservation != null && !#strings.isEmpty(visitEval.overallObservation) ? visitEval.overallObservation : '—'}">—</div>
                        </div>

                        <div class="small">
                            <div class="muted mb-1">Additional Remarks</div>
                            <div class="comment-box"
                                 th:text="${visitEval != null && visitEval.additionalRemarks != null && !#strings.isEmpty(visitEval.additionalRemarks) ? visitEval.additionalRemarks : '—'}">—</div>
                        </div>

                    </div>
                </div>

                <!-- Industry Supervisor (40) -->
                <div class="col-md-6">
                    <div class="score-card p-3 h-100">
                        <div class="score-head">
                            <div class="score-title">Industry Supervisor (40)</div>

                            <th:block th:with="hasInd=${sa != null && (sa.isAttributes30 != null || sa.isOverall10 != null || sa.isSkills20 != null || sa.isCommunication10 != null || sa.isTeamwork10 != null)}">
                                <span class="pill pill-na" th:if="${!hasInd}">PENDING</span>
                                <span class="pill pill-ok" th:if="${hasInd}" th:text="${#numbers.formatDecimal(industry40,1,2) + ' / 40'}">0.00 / 40</span>
                            </th:block>
                        </div>

                        <div class="score-lines">
                            <div class="score-line">
                                <div class="label">Attributes</div>
                                <div class="val" th:text="${sa != null && sa.isAttributes30 != null ? sa.isAttributes30 : 0} + ' / 30'">0 / 30</div>
                            </div>
                            <div class="score-line">
                                <div class="label">Overall</div>
                                <div class="val" th:text="${sa != null && sa.isOverall10 != null ? sa.isOverall10 : 0} + ' / 10'">0 / 10</div>
                            </div>
                        </div>

                        <div class="divider"></div>

                        <div class="score-line">
                            <div class="label fw-semibold">Total</div>
                            <div class="val" th:text="${#numbers.formatDecimal(industry40,1,2) + ' / 40'}">0.00 / 40</div>
                        </div>

                        <div class="divider"></div>

                        <div class="fw-semibold mb-2">Supervisor Comments</div>
                        <div class="comment-box"
                             th:text="${supEval != null && supEval.overallComment != null && !#strings.isEmpty(supEval.overallComment) ? supEval.overallComment : '—'}">—</div>

                        <div class="small mt-2" th:if="${supEval != null && supEval.careerOpportunityRemark != null && !#strings.isEmpty(supEval.careerOpportunityRemark)}">
                            <div class="muted mb-1">Career Opportunity Remark</div>
                            <div class="comment-box" th:text="${supEval.careerOpportunityRemark}">—</div>
                        </div>

                    </div>
                </div>

                <!-- Logbook (10) -->
                <div class="col-md-6">
                    <div class="score-card p-3 h-100">
                        <div class="score-head">
                            <div class="score-title">Logbook (10)</div>
                            <span class="pill pill-na" th:if="${logbook10 == null}">PENDING</span>
                            <span class="pill pill-ok" th:if="${logbook10 != null}" th:text="${#numbers.formatDecimal(logbook10,1,2) + ' / 10'}">0.00 / 10</span>
                        </div>

                        <div class="score-line">
                            <div class="label">Logbook Score</div>
                            <div class="val">
                                <span th:if="${logbook10 == null}" class="muted">—</span>
                                <span th:if="${logbook10 != null}" th:text="${#numbers.formatDecimal(logbook10,1,2) + ' / 10'}">0.00 / 10</span>
                            </div>
                        </div>

                        <div class="divider"></div>

                        <div class="score-line">
                            <div class="label fw-semibold">Total</div>
                            <div class="val">
                                <span th:if="${logbook10 == null}" class="muted">—</span>
                                <span th:if="${logbook10 != null}" th:text="${#numbers.formatDecimal(logbook10,1,2) + ' / 10'}">0.00 / 10</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Final Report (10) -->
                <div class="col-md-6">
                    <div class="score-card p-3 h-100">
                        <div class="score-head">
                            <div class="score-title">Final Report (10)</div>

                            <th:block th:with="hasRep=${sa != null && (sa.adminReportWritten5 != null || sa.adminReportVideo5 != null)}">
                                <span class="pill pill-na" th:if="${!hasRep}">PENDING</span>
                                <span class="pill pill-ok" th:if="${hasRep}" th:text="${#numbers.formatDecimal(report10,1,2) + ' / 10'}">0.00 / 10</span>
                            </th:block>
                        </div>

                        <div class="score-lines">
                            <div class="score-line">
                                <div class="label">Written</div>
                                <div class="val" th:text="${sa != null && sa.adminReportWritten5 != null ? sa.adminReportWritten5 : 0} + ' / 5'">0 / 5</div>
                            </div>
                            <div class="score-line">
                                <div class="label">Video</div>
                                <div class="val" th:text="${sa != null && sa.adminReportVideo5 != null ? sa.adminReportVideo5 : 0} + ' / 5'">0 / 5</div>
                            </div>
                        </div>

                        <div class="divider"></div>

                        <div class="score-line">
                            <div class="label fw-semibold">Total</div>
                            <div class="val" th:text="${#numbers.formatDecimal(report10,1,2) + ' / 10'}">0.00 / 10</div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="divider my-4"></div>

            <!-- Overall Summary -->
            <div class="summary-grid">
                <div class="score-card p-3">
                    <div class="muted small">Overall Total (out of 100)</div>
                    <div class="h4 mb-0" th:text="${#numbers.formatDecimal(total100New, 1, 2)}">0.00</div>
                </div>

                <div class="score-card p-3">
                    <div class="muted small">Grade</div>
                    <div class="h4 mb-0" th:text="${gradeNew}">-</div>
                </div>

                <div class="score-card p-3">
                    <div class="muted small">Status</div>
                    <div class="h4 mb-0" th:text="${sa != null && sa.status != null ? sa.status : '-'}">-</div>
                </div>
            </div>

        </div>
    </div>

</div>

</body>
</html>
